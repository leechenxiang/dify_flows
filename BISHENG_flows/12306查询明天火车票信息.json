{"status":2,"description":"","user_id":3,"guide_word":null,"create_time":"2025-05-26T14:42:59","logo":"","name":"12306查询明天火车票信息","flow_type":10,"update_time":"2025-05-27T12:13:10","id":"05435b405e8b4ceea208798b3ff1466c","nodes":[{"id":"start_ecfec","data":{"v":"1","id":"start_ecfec","name":"开始","type":"start","description":"工作流运行的起始节点。","group_params":[{"name":"开场引导","params":[{"key":"guide_word","type":"textarea","label":"开场白","value":"请开始你的表演","placeholder":"每次工作流开始执行时向用户发送此消息，支持 Markdown 格式，为空时不发送。"},{"key":"guide_question","help":"为用户提供推荐问题，引导用户输入，超过3个时将随机选取3个。","type":"input_list","label":"引导问题","value":["随便输入内容",""],"placeholder":"请输入引导问题"}]},{"name":"全局变量","params":[{"key":"current_time","type":"var","label":"当前时间","value":"","global":"key"},{"key":"chat_history","type":"chat_history_num","value":10,"global":"key"},{"key":"preset_question","help":"适合文档审核、报告生成等场景，利用提前预置的问题批量进行 RAG 问答。","type":"input_list","label":"预置问题列表","value":[{"key":"0410c4","value":""}],"global":"item:input_list","placeholder":"输入批量预置问题"}]}]},"type":"flowNode","dragging":false,"measured":{"width":334,"height":661},"position":{"x":-205.74946205621313,"y":-132.85943769342967},"selected":false},{"id":"output_768e8","data":{"v":"2","id":"output_768e8","name":"输出","type":"output","description":"可向用户发送消息，并且支持进行更丰富的交互，例如请求用户批准进行某项敏感操作、允许用户在模型输出内容的基础上直接修改并提交。","group_params":[{"params":[{"key":"message","type":"var_textarea_file","label":"消息内容","value":{"msg":"{{#llm_716c4.output#}}","files":[]},"varZh":{"llm_716c4.output":"大模型/output","tool_4582f.output":"get-tickets/output"},"global":"key","required":true,"placeholder":"输入需要发送给用户的消息，例如“接下来我将执行 XX 操作，请您确认”，“以下是我的初版草稿，您可以在其基础上进行修改”"},{"key":"output_result","type":"output_form","label":"用户输入内容","value":{"type":"none","value":""},"global":"value.type=input","options":[],"required":false}]}]},"type":"flowNode","dragging":false,"measured":{"width":334,"height":465},"position":{"x":2640.086147309414,"y":-117.36399047304796},"selected":false},{"id":"end_45013","data":{"v":"1","id":"end_45013","name":"结束","type":"end","description":"工作流运行到此结束。","group_params":[]},"type":"flowNode","dragging":false,"measured":{"width":334,"height":135},"position":{"x":2661.054380174089,"y":449.5107123337597},"selected":false},{"id":"tool_4582f","data":{"id":"tool_4582f","name":"get-tickets","type":"tool","tool_key":"tool_type_21_ae6ed0059b835132d6ec5f9d6efdb052","description":"查询12306余票信息。","group_params":[{"name":"工具参数","params":[{"key":"date","desc":"查询日期，格式为 \"yyyy-MM-dd\"。如果用户提供的是相对日期（如“明天”），请务必先调用 `get-current-date` 接口获取当前日期，并计算出目标日期。","test":"input","type":"var_textarea","label":"date","value":"{{#code_dd473.date#}}","varZh":{"code_dd473.date":"获得日期/date","tool_ac093.output":"get-current-date/output"},"required":true},{"key":"fromStation","desc":"出发地的 `station_code` 。必须是通过 `get-station-code-by-name` 或 `get-station-code-of-city` 接口查询得到的编码，严禁直接使用中文地名。","test":"input","type":"var_textarea","label":"fromStation","value":"{{#code_0f78f.station_code#}}","varZh":{"tool_99843.output":"获得出发城市code/output","input_b8620.start_city":"输入/start_city","code_0f78f.station_code":"获得出发城市代码/station_code"},"required":true},{"key":"toStation","desc":"到达地的 `station_code` 。必须是通过 `get-station-code-by-name` 或 `get-station-code-of-city` 接口查询得到的编码，严禁直接使用中文地名。","test":"input","type":"var_textarea","label":"toStation","value":"{{#code_16cb2.station_code#}}","varZh":{"tool_99843.output":"获得出发城市code/output","input_b8620.end_city":"输入/end_city","code_0f78f.station_code":"获得出发城市代码/station_code","code_16cb2.station_code":"获得目标城市代码/station_code"},"required":true},{"key":"trainFilterFlags","desc":"车次筛选条件，默认为空，即不筛选。例如用户说“高铁票”，则应使用 \"G\"。可选标志：[G(高铁/城际),D(动车),Z(直达特快),T(特快),K(快速),O(其他),F(复兴号),S(智能动车组)]","test":"input","type":"var_textarea","label":"trainFilterFlags","value":"F","varZh":{"tool_6333b.output":"获得目标城市code/output","code_16cb2.station_code":"获得目标城市代码/station_code"},"required":false}]},{"name":"输出","params":[{"key":"output","type":"var","label":"输出变量","value":"","global":"key"}]}]},"type":"flowNode","dragging":false,"measured":{"width":334,"height":987},"position":{"x":1608.52197034376,"y":-143.87650945041796},"selected":true},{"id":"input_b8620","data":{"v":"2","id":"input_b8620","tab":{"value":"form_input","options":[{"key":"dialog_input","help":"接收用户从对话框输入的内容。","label":"对话框输入"},{"key":"form_input","help":"将会在用户会话界面弹出一个表单，接收用户从表单提交的内容。","label":"表单输入"}]},"name":"输入","type":"input","description":"接收用户在会话页面的输入，支持 2 种形式：对话框输入，表单输入。","group_params":[{"name":"","params":[{"key":"user_input","tab":"dialog_input","type":"var","label":"输入文本内容","global":"key"},{"key":"dialog_files_content","tab":"dialog_input","type":"var","label":"上传文件内容","global":"key"},{"key":"dialog_files_content_size","min":0,"tab":"dialog_input","type":"char_number","label":"文件内容长度上限","value":15000},{"key":"dialog_file_accept","tab":"dialog_input","type":"select_fileaccept","label":"上传文件类型","value":"all"},{"key":"dialog_image_files","tab":"dialog_input","help":"提取上传文件中的图片文件，当助手或大模型节点使用多模态大模型时，可传入此图片。","type":"var","label":"上传图片文件","global":"key"},{"key":"form_input","tab":"form_input","type":"form","label":"+ 添加表单项","value":[{"key":"start_city","type":"text","value":"出发城市","options":[],"multiple":false,"required":true,"file_path":"file_path","file_type":"all","image_file":"image_file","file_content":"file_content","file_content_size":15000},{"key":"end_city","type":"text","value":"目标城市","options":[],"multiple":false,"required":true,"file_path":"file_path","file_type":"all","image_file":"image_file","file_content":"file_content","file_content_size":15000}],"global":"item:form_input"}]}]},"type":"flowNode","dragging":false,"measured":{"width":334,"height":360},"position":{"x":-205.3747538884731,"y":532.8502078230546},"selected":false},{"id":"tool_99843","data":{"id":"tool_99843","name":"获得出发城市code","type":"tool","tool_key":"tool_type_21_3b06dbce6b82d4eaa20bfb9a20c6fa9c","description":"通过中文城市名查询代表该城市的 `station_code`。此接口主要用于在用户提供**城市名**作为出发地或到达地时，为接口准备 `station_code` 参数。","group_params":[{"name":"工具参数","params":[{"key":"citys","desc":"要查询的城市，比如\"北京\"。若要查询多个城市，请用|分割，比如\"北京|上海\"。","test":"input","type":"var_textarea","label":"citys","value":"{{#input_b8620.start_city#}}","varZh":{"input_b8620.start_city":"输入/start_city"},"required":true}]},{"name":"输出","params":[{"key":"output","type":"var","label":"输出变量","value":"","global":"key"}]}]},"type":"flowNode","dragging":false,"measured":{"width":334,"height":474},"position":{"x":668.4582104723727,"y":-142.60655298152162},"selected":false},{"id":"tool_6333b","data":{"id":"tool_6333b","name":"获得目标城市code","type":"tool","tool_key":"tool_type_21_3b06dbce6b82d4eaa20bfb9a20c6fa9c","description":"通过中文城市名查询代表该城市的 `station_code`。此接口主要用于在用户提供**城市名**作为出发地或到达地时，为接口准备 `station_code` 参数。","group_params":[{"name":"工具参数","params":[{"key":"citys","desc":"要查询的城市，比如\"北京\"。若要查询多个城市，请用|分割，比如\"北京|上海\"。","test":"input","type":"var_textarea","label":"citys","value":"{{#input_b8620.end_city#}}","varZh":{"input_b8620.end_city":"输入/end_city"},"required":true}]},{"name":"输出","params":[{"key":"output","type":"var","label":"输出变量","value":"","global":"key"}]}]},"type":"flowNode","dragging":false,"measured":{"width":334,"height":474},"position":{"x":1100.0884452129128,"y":-141.2986201109137},"selected":false},{"id":"tool_ac093","data":{"id":"tool_ac093","name":"get-current-date","type":"tool","tool_key":"tool_type_21_fb8cbd94bf9acb4c825fd0a146ae8006","description":"获取当前日期，以上海时区（Asia/Shanghai, UTC+8）为准，返回格式为 \"yyyy-MM-dd\"。主要用于解析用户提到的相对日期（如“明天”、“下周三”），为其他需要日期的接口提供准确的日期输入。","group_params":[{"name":"工具参数","params":[]},{"name":"输出","params":[{"key":"output","type":"var","label":"输出变量","value":"","global":"key"}]}]},"type":"flowNode","dragging":false,"measured":{"width":334,"height":278},"position":{"x":240.79725032031345,"y":-140.9860139303386},"selected":false},{"id":"code_dd473","data":{"v":"1","id":"code_dd473","name":"获得日期（明天）","type":"code","description":"自定义需要执行的代码。","group_params":[{"name":"入参","params":[{"key":"code_input","test":"input","type":"code_input","value":[{"key":"date_json","type":"ref","label":"get-current-date/output","value":"tool_ac093.output"}],"required":true}]},{"name":"执行代码","params":[{"key":"code","type":"code","value":"import json\nfrom datetime import datetime, timedelta\n\ndef main(date_json: str) -> dict:\n    data = json.loads(date_json)\n    date_text = data['content'][0]['text']\n    \n    # 解析日期并计算第二天\n    try:\n        date_obj = datetime.strptime(date_text, '%Y-%m-%d')\n        next_day = (date_obj + timedelta(days=1)).strftime('%Y-%m-%d')\n    except ValueError:\n        next_day = None  # 如果日期格式错误，则返回 None\n    \n    return {'date': next_day}","required":true}]},{"name":"出参","params":[{"key":"code_output","type":"code_output","value":[{"key":"date","type":"str"}],"global":"code:value.map(el => ({ label: el.key, value: el.key }))","required":true}]}]},"type":"flowNode","dragging":false,"measured":{"width":334,"height":618},"position":{"x":235.6997215675116,"y":192.0278687160054},"selected":false},{"id":"code_0f78f","data":{"v":"1","id":"code_0f78f","name":"获得出发城市代码","type":"code","description":"自定义需要执行的代码。","group_params":[{"name":"入参","params":[{"key":"code_input","test":"input","type":"code_input","value":[{"key":"city_json","type":"ref","label":"获得出发城市code/output","value":"tool_99843.output"}],"required":true}]},{"name":"执行代码","params":[{"key":"code","type":"code","value":"import json\n\ndef main(city_json: str) -> dict:\n    data = json.loads(city_json)\n    text_content = data['content'][0]['text']\n    nested_data = json.loads(text_content)\n    \n    # 遍历嵌套数据中的每个条目，寻找包含 station_code 的对象\n    for key in nested_data:\n        if 'station_code' in nested_data[key]:\n            station_code = nested_data[key]['station_code']\n            break\n    else:\n        station_code = None  # 如果没有找到匹配项，则返回 None\n    \n    return {'station_code': station_code}","required":true}]},{"name":"出参","params":[{"key":"code_output","type":"code_output","value":[{"key":"station_code","type":"str"}],"global":"code:value.map(el => ({ label: el.key, value: el.key }))","required":true}]}]},"type":"flowNode","dragging":false,"measured":{"width":334,"height":618},"position":{"x":668.3824231666312,"y":340.60697258833864},"selected":false},{"id":"code_16cb2","data":{"v":"1","id":"code_16cb2","name":"获得目标城市代码","type":"code","description":"自定义需要执行的代码。","group_params":[{"name":"入参","params":[{"key":"code_input","test":"input","type":"code_input","value":[{"key":"city_json","type":"ref","label":"获得目标城市code/output","value":"tool_6333b.output"}],"required":true}]},{"name":"执行代码","params":[{"key":"code","type":"code","value":"import json\n\ndef main(city_json: str) -> dict:\n    data = json.loads(city_json)\n    text_content = data['content'][0]['text']\n    nested_data = json.loads(text_content)\n    \n    # 遍历嵌套数据中的每个条目，寻找包含 station_code 的对象\n    for key in nested_data:\n        if 'station_code' in nested_data[key]:\n            station_code = nested_data[key]['station_code']\n            break\n    else:\n        station_code = None  # 如果没有找到匹配项，则返回 None\n    \n    return {'station_code': station_code}","required":true}]},{"name":"出参","params":[{"key":"code_output","type":"code_output","value":[{"key":"station_code","type":"str"}],"global":"code:value.map(el => ({ label: el.key, value: el.key }))","required":true}]}]},"type":"flowNode","dragging":false,"measured":{"width":334,"height":618},"position":{"x":1107.313685425791,"y":373.0670521669253},"selected":false},{"id":"llm_716c4","data":{"v":"2","id":"llm_716c4","tab":{"value":"single","options":[{"key":"single","label":"单次运行"},{"key":"batch","label":"批量运行"}]},"name":"大模型","type":"llm","description":"调用大模型回答用户问题或者处理任务。","group_params":[{"params":[{"key":"batch_variable","tab":"batch","help":"选择需要批处理的变量，将会多次运行本节点，每次运行时从选择的变量中取一项赋值给batch_variable进行处理。","test":"var","type":"user_question","label":"批处理变量","value":[],"global":"self","linkage":"output","required":true,"placeholder":"请选择批处理变量"}]},{"name":"模型设置","params":[{"key":"model_id","type":"bisheng_model","label":"模型","value":7,"required":true,"placeholder":"请在模型管理中配置 LLM 模型"},{"key":"temperature","step":0.1,"type":"slide","label":"温度","scope":[0,2],"value":0.7}]},{"name":"提示词","params":[{"key":"system_prompt","test":"var","type":"var_textarea","label":"系统提示词","value":"你是一个markdown编辑助手，能够根据各种复杂的信息汇总成markdown格式的内容。请根据用户输入的内容提取火车票相关信息，优化内容并最终以markdown表格的形式输出。如果用户提供的内容中包含html标签，请务必全部去除。"},{"key":"user_prompt","test":"var","type":"var_textarea","label":"用户提示词","value":"{{#tool_4582f.output#}}","varZh":{"tool_4582f.output":"get-tickets/output"},"required":true},{"key":"image_prompt","help":"当使用多模态大模型时，可通过此功能传入图片，结合图像内容进行问答","type":"image_prompt","label":"视觉","value":[]}]},{"name":"输出","params":[{"key":"output_user","help":"一般在问答等场景可开启，文档审核、报告生成等场景可关闭。","type":"switch","label":"将输出结果展示在会话中","value":true},{"key":"output","help":"模型输出内容将会存储在该变量中。","type":"var","label":"输出变量","value":[],"global":"code:value.map(el => ({ label: el.label, value: el.key }))"}]}]},"type":"flowNode","dragging":false,"measured":{"width":334,"height":838},"position":{"x":2120.4711607844583,"y":-128.95757305800268},"selected":false}],"edges":[{"id":"xy-edge__start_ecfecright_handle-input_b8620left_handle","type":"customEdge","source":"start_ecfec","target":"input_b8620","animated":true,"sourceHandle":"right_handle","targetHandle":"left_handle"},{"id":"xy-edge__input_b8620right_handle-tool_ac093left_handle","type":"customEdge","source":"input_b8620","target":"tool_ac093","animated":true,"sourceHandle":"right_handle","targetHandle":"left_handle"},{"id":"xy-edge__tool_ac093right_handle-code_dd473left_handle","type":"customEdge","source":"tool_ac093","target":"code_dd473","animated":true,"sourceHandle":"right_handle","targetHandle":"left_handle"},{"id":"xy-edge__code_dd473right_handle-tool_99843left_handle","type":"customEdge","source":"code_dd473","target":"tool_99843","animated":true,"sourceHandle":"right_handle","targetHandle":"left_handle"},{"id":"xy-edge__tool_99843right_handle-code_0f78fleft_handle","type":"customEdge","source":"tool_99843","target":"code_0f78f","animated":true,"sourceHandle":"right_handle","targetHandle":"left_handle"},{"id":"xy-edge__code_0f78fright_handle-tool_6333bleft_handle","type":"customEdge","source":"code_0f78f","target":"tool_6333b","animated":true,"sourceHandle":"right_handle","targetHandle":"left_handle"},{"id":"xy-edge__tool_6333bright_handle-code_16cb2left_handle","type":"customEdge","source":"tool_6333b","target":"code_16cb2","animated":true,"sourceHandle":"right_handle","targetHandle":"left_handle"},{"id":"xy-edge__code_16cb2right_handle-tool_4582fleft_handle","type":"customEdge","source":"code_16cb2","target":"tool_4582f","animated":true,"sourceHandle":"right_handle","targetHandle":"left_handle"},{"id":"xy-edge__output_768e8right_handle-end_45013left_handle","type":"customEdge","source":"output_768e8","target":"end_45013","animated":true,"sourceHandle":"right_handle","targetHandle":"left_handle"},{"id":"xy-edge__tool_4582fright_handle-llm_716c4left_handle","type":"customEdge","source":"tool_4582f","target":"llm_716c4","animated":true,"sourceHandle":"right_handle","targetHandle":"left_handle"},{"id":"xy-edge__llm_716c4right_handle-output_768e8left_handle","type":"customEdge","source":"llm_716c4","target":"output_768e8","animated":true,"sourceHandle":"right_handle","targetHandle":"left_handle"}],"viewport":{"x":195.5236482845454,"y":208.57781471295996,"zoom":0.5345248179022862}}